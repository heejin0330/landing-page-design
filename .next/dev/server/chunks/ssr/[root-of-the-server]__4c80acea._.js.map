{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/cording/landing-page-design/actions/gemini.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { GoogleGenerativeAI } from \"@google/generative-ai\";\r\n\r\ninterface ChatMessage {\r\n  role: \"user\" | \"assistant\";\r\n  content: string;\r\n}\r\n\r\ninterface ChatResponse {\r\n  success: boolean;\r\n  message?: string;\r\n  error?: string;\r\n}\r\n\r\nexport async function sendChatMessage(\r\n  message: string,\r\n  history: ChatMessage[] = []\r\n): Promise<ChatResponse> {\r\n  try {\r\n    const apiKey = process.env.GEMINI_API_KEY;\r\n\r\n    if (!apiKey) {\r\n      console.error(\"GEMINI_API_KEY가 설정되지 않았습니다.\");\r\n      return {\r\n        success: false,\r\n        error: \"서버 설정 오류: API 키가 없습니다.\",\r\n      };\r\n    }\r\n\r\n    const genAI = new GoogleGenerativeAI(apiKey);\r\n    const model = genAI.getGenerativeModel({ model: \"gemini-2.5-flash\" });\r\n\r\n    // 히스토리에서 초기 assistant 메시지 제외\r\n    // 첫 번째 메시지가 assistant인 경우 제외 (초기 인사 메시지)\r\n    const filteredHistory = history.filter((msg, index) => {\r\n      if (index === 0 && msg.role === \"assistant\") {\r\n        return false;\r\n      }\r\n      return true;\r\n    });\r\n\r\n    // 채팅 히스토리를 Gemini 형식으로 변환\r\n    // 첫 번째 메시지는 반드시 user여야 함\r\n    const chatHistory = filteredHistory\r\n      .map((msg) => ({\r\n        role: msg.role === \"user\" ? \"user\" : \"model\",\r\n        parts: [{ text: msg.content }],\r\n      }))\r\n      .filter((msg, index) => {\r\n        // 첫 번째 메시지가 user가 아니면 제외\r\n        if (index === 0 && msg.role !== \"user\") {\r\n          return false;\r\n        }\r\n        return true;\r\n      });\r\n\r\n    // 채팅 시작 (히스토리가 있으면 전달, 없으면 빈 배열)\r\n    const chat = model.startChat({\r\n      history: chatHistory.length > 0 ? chatHistory : undefined,\r\n    });\r\n\r\n    // 메시지 전송 및 응답 받기\r\n    const result = await chat.sendMessage(message);\r\n    const response = await result.response;\r\n    const text = response.text();\r\n\r\n    return {\r\n      success: true,\r\n      message: text,\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Gemini API 오류:\", error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : \"알 수 없는 오류가 발생했습니다.\",\r\n    };\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAEA;;;;AAaO,eAAe,gBACpB,OAAe,EACf,UAAyB,EAAE;IAE3B,IAAI;QACF,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;QAEzC,IAAI,CAAC,QAAQ;YACX,QAAQ,KAAK,CAAC;YACd,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,MAAM,QAAQ,IAAI,8PAAkB,CAAC;QACrC,MAAM,QAAQ,MAAM,kBAAkB,CAAC;YAAE,OAAO;QAAmB;QAEnE,6BAA6B;QAC7B,yCAAyC;QACzC,MAAM,kBAAkB,QAAQ,MAAM,CAAC,CAAC,KAAK;YAC3C,IAAI,UAAU,KAAK,IAAI,IAAI,KAAK,aAAa;gBAC3C,OAAO;YACT;YACA,OAAO;QACT;QAEA,0BAA0B;QAC1B,yBAAyB;QACzB,MAAM,cAAc,gBACjB,GAAG,CAAC,CAAC,MAAQ,CAAC;gBACb,MAAM,IAAI,IAAI,KAAK,SAAS,SAAS;gBACrC,OAAO;oBAAC;wBAAE,MAAM,IAAI,OAAO;oBAAC;iBAAE;YAChC,CAAC,GACA,MAAM,CAAC,CAAC,KAAK;YACZ,yBAAyB;YACzB,IAAI,UAAU,KAAK,IAAI,IAAI,KAAK,QAAQ;gBACtC,OAAO;YACT;YACA,OAAO;QACT;QAEF,iCAAiC;QACjC,MAAM,OAAO,MAAM,SAAS,CAAC;YAC3B,SAAS,YAAY,MAAM,GAAG,IAAI,cAAc;QAClD;QAEA,iBAAiB;QACjB,MAAM,SAAS,MAAM,KAAK,WAAW,CAAC;QACtC,MAAM,WAAW,MAAM,OAAO,QAAQ;QACtC,MAAM,OAAO,SAAS,IAAI;QAE1B,OAAO;YACL,SAAS;YACT,SAAS;QACX;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kBAAkB;QAChC,OAAO;YACL,SAAS;YACT,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAClD;IACF;AACF;;;IA/DsB;;AAAA,8WAAA"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///C:/cording/landing-page-design/actions/news.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport Parser from \"rss-parser\";\r\n\r\ninterface NewsItem {\r\n  id: string;\r\n  category: \"고교입시\" | \"마이스터고\" | \"특성화고\";\r\n  title: string;\r\n  summary: string;\r\n  date: string;\r\n  link: string;\r\n}\r\n\r\ninterface CollectNewsResult {\r\n  success: boolean;\r\n  count?: number;\r\n  error?: string;\r\n}\r\n\r\ninterface GetNewsResult {\r\n  success: boolean;\r\n  news?: NewsItem[];\r\n  error?: string;\r\n}\r\n\r\n// RSS 피드 URL 목록\r\nconst RSS_FEEDS = [\r\n  // 교육부 공식 RSS (예시 - 실제 URL로 변경 필요)\r\n  // \"https://www.moe.go.kr/rss/rss.jsp\",\r\n  // 연합뉴스 교육 섹션 (예시)\r\n  // \"https://www.yna.co.kr/rss/education.xml\",\r\n  // 뉴시스 교육 섹션 (예시)\r\n  // \"https://www.newsis.com/rss/education.xml\",\r\n];\r\n\r\n// 키워드 매칭 함수\r\nfunction categorizeNews(title: string, summary: string): \"고교입시\" | \"마이스터고\" | \"특성화고\" | null {\r\n  const text = (title + \" \" + summary).toLowerCase();\r\n  \r\n  const keywords = {\r\n    고교입시: [\"고교입시\", \"고등학교 입시\", \"입학전형\", \"학생부\", \"내신\", \"입시\", \"고입\"],\r\n    마이스터고: [\"마이스터고\", \"마이스터\", \"특성화고\", \"기술고\", \"전문계고\"],\r\n    특성화고: [\"특성화고\", \"특성화 고등학교\", \"전문계\", \"실업계\", \"상업고\", \"공업고\", \"농업고\"],\r\n  };\r\n\r\n  // 마이스터고 키워드가 있으면 마이스터고로 분류\r\n  if (keywords.마이스터고.some((kw) => text.includes(kw))) {\r\n    return \"마이스터고\";\r\n  }\r\n  \r\n  // 특성화고 키워드가 있으면 특성화고로 분류\r\n  if (keywords.특성화고.some((kw) => text.includes(kw))) {\r\n    return \"특성화고\";\r\n  }\r\n  \r\n  // 고교입시 키워드가 있으면 고교입시로 분류\r\n  if (keywords.고교입시.some((kw) => text.includes(kw))) {\r\n    return \"고교입시\";\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n// Notion에 뉴스 저장\r\nasync function saveNewsToNotion(news: {\r\n  title: string;\r\n  category: string;\r\n  summary: string;\r\n  link: string;\r\n  date: string;\r\n}): Promise<boolean> {\r\n  try {\r\n    const notionApiKey = process.env.NOTION_API_KEY;\r\n    const notionNewsDatabaseId = process.env.NOTION_NEWS_DATABASE_ID;\r\n\r\n    if (!notionApiKey || !notionNewsDatabaseId) {\r\n      console.error(\"Notion API 키 또는 데이터베이스 ID가 설정되지 않았습니다.\");\r\n      return false;\r\n    }\r\n\r\n    const properties: Record<string, any> = {\r\n      제목: {\r\n        title: [\r\n          {\r\n            text: {\r\n              content: news.title,\r\n            },\r\n          },\r\n        ],\r\n      },\r\n      카테고리: {\r\n        select: {\r\n          name: news.category,\r\n        },\r\n      },\r\n      요약: {\r\n        rich_text: [\r\n          {\r\n            text: {\r\n              content: news.summary,\r\n            },\r\n          },\r\n        ],\r\n      },\r\n      링크: {\r\n        url: news.link,\r\n      },\r\n      날짜: {\r\n        date: {\r\n          start: news.date,\r\n        },\r\n      },\r\n      수집일시: {\r\n        date: {\r\n          start: new Date().toISOString(),\r\n        },\r\n      },\r\n    };\r\n\r\n    const response = await fetch(\"https://api.notion.com/v1/pages\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        Authorization: `Bearer ${notionApiKey}`,\r\n        \"Content-Type\": \"application/json\",\r\n        \"Notion-Version\": \"2022-06-28\",\r\n      },\r\n      body: JSON.stringify({\r\n        parent: {\r\n          database_id: notionNewsDatabaseId,\r\n        },\r\n        properties,\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json().catch(() => ({}));\r\n      console.error(\"Notion API 오류:\", errorData);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    console.error(\"뉴스 저장 오류:\", error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// 중복 체크 (링크 기준)\r\nasync function checkDuplicate(link: string): Promise<boolean> {\r\n  try {\r\n    const notionApiKey = process.env.NOTION_API_KEY;\r\n    const notionNewsDatabaseId = process.env.NOTION_NEWS_DATABASE_ID;\r\n\r\n    if (!notionApiKey || !notionNewsDatabaseId) {\r\n      return false;\r\n    }\r\n\r\n    const response = await fetch(\r\n      `https://api.notion.com/v1/databases/${notionNewsDatabaseId}/query`,\r\n      {\r\n        method: \"POST\",\r\n        headers: {\r\n          Authorization: `Bearer ${notionApiKey}`,\r\n          \"Content-Type\": \"application/json\",\r\n          \"Notion-Version\": \"2022-06-28\",\r\n        },\r\n        body: JSON.stringify({\r\n          filter: {\r\n            property: \"링크\",\r\n            url: {\r\n              equals: link,\r\n            },\r\n          },\r\n        }),\r\n      }\r\n    );\r\n\r\n    if (!response.ok) {\r\n      return false;\r\n    }\r\n\r\n    const data = await response.json();\r\n    return data.results && data.results.length > 0;\r\n  } catch (error) {\r\n    console.error(\"중복 체크 오류:\", error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// 뉴스 수집 서버 액션\r\nexport async function collectNews(): Promise<CollectNewsResult> {\r\n  try {\r\n    const notionApiKey = process.env.NOTION_API_KEY;\r\n    const notionNewsDatabaseId = process.env.NOTION_NEWS_DATABASE_ID;\r\n\r\n    if (!notionApiKey || !notionNewsDatabaseId) {\r\n      return {\r\n        success: false,\r\n        error: \"Notion API 키 또는 데이터베이스 ID가 설정되지 않았습니다.\",\r\n      };\r\n    }\r\n\r\n    if (RSS_FEEDS.length === 0) {\r\n      return {\r\n        success: false,\r\n        error: \"RSS 피드 URL이 설정되지 않았습니다.\",\r\n      };\r\n    }\r\n\r\n    const parser = new Parser();\r\n    let collectedCount = 0;\r\n\r\n    // 각 RSS 피드에서 뉴스 수집\r\n    for (const feedUrl of RSS_FEEDS) {\r\n      try {\r\n        const feed = await parser.parseURL(feedUrl);\r\n\r\n        for (const item of feed.items || []) {\r\n          // 카테고리 분류\r\n          const category = categorizeNews(item.title || \"\", item.contentSnippet || item.content || \"\");\r\n          \r\n          if (!category) {\r\n            continue; // 관련 없는 뉴스는 건너뛰기\r\n          }\r\n\r\n          // 중복 체크\r\n          const link = item.link || \"\";\r\n          if (!link) {\r\n            continue;\r\n          }\r\n\r\n          const isDuplicate = await checkDuplicate(link);\r\n          if (isDuplicate) {\r\n            continue; // 이미 저장된 뉴스는 건너뛰기\r\n          }\r\n\r\n          // 뉴스 저장\r\n          const summary = item.contentSnippet || item.content || item.title || \"\";\r\n          const date = item.pubDate ? new Date(item.pubDate).toISOString().split(\"T\")[0] : new Date().toISOString().split(\"T\")[0];\r\n\r\n          const saved = await saveNewsToNotion({\r\n            title: item.title || \"\",\r\n            category,\r\n            summary: summary.substring(0, 500), // 요약 길이 제한\r\n            link,\r\n            date,\r\n          });\r\n\r\n          if (saved) {\r\n            collectedCount++;\r\n          }\r\n\r\n          // API 호출 제한을 고려하여 약간의 지연\r\n          await new Promise((resolve) => setTimeout(resolve, 100));\r\n        }\r\n      } catch (error) {\r\n        console.error(`RSS 피드 파싱 오류 (${feedUrl}):`, error);\r\n        continue;\r\n      }\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      count: collectedCount,\r\n    };\r\n  } catch (error) {\r\n    console.error(\"뉴스 수집 오류:\", error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : \"알 수 없는 오류가 발생했습니다.\",\r\n    };\r\n  }\r\n}\r\n\r\n// 뉴스 조회 서버 액션\r\nexport async function getNews(limit: number = 6): Promise<GetNewsResult> {\r\n  try {\r\n    const notionApiKey = process.env.NOTION_API_KEY;\r\n    const notionNewsDatabaseId = process.env.NOTION_NEWS_DATABASE_ID;\r\n\r\n    if (!notionApiKey || !notionNewsDatabaseId) {\r\n      return {\r\n        success: false,\r\n        error: \"Notion API 키 또는 데이터베이스 ID가 설정되지 않았습니다.\",\r\n      };\r\n    }\r\n\r\n    const response = await fetch(\r\n      `https://api.notion.com/v1/databases/${notionNewsDatabaseId}/query`,\r\n      {\r\n        method: \"POST\",\r\n        headers: {\r\n          Authorization: `Bearer ${notionApiKey}`,\r\n          \"Content-Type\": \"application/json\",\r\n          \"Notion-Version\": \"2022-06-28\",\r\n        },\r\n        body: JSON.stringify({\r\n          sorts: [\r\n            {\r\n              property: \"날짜\",\r\n              direction: \"descending\",\r\n            },\r\n          ],\r\n          page_size: limit,\r\n        }),\r\n      }\r\n    );\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json().catch(() => ({}));\r\n      console.error(\"Notion API 오류:\", errorData);\r\n      return {\r\n        success: false,\r\n        error: \"뉴스를 불러오는 중 오류가 발생했습니다.\",\r\n      };\r\n    }\r\n\r\n    const data = await response.json();\r\n    const newsItems: NewsItem[] = data.results.map((page: any) => {\r\n      const props = page.properties;\r\n      return {\r\n        id: page.id,\r\n        category: props.카테고리?.select?.name || \"고교입시\",\r\n        title: props.제목?.title?.[0]?.text?.content || \"\",\r\n        summary: props.요약?.rich_text?.[0]?.text?.content || \"\",\r\n        date: props.날짜?.date?.start || \"\",\r\n        link: props.링크?.url || \"#\",\r\n      };\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      news: newsItems,\r\n    };\r\n  } catch (error) {\r\n    console.error(\"뉴스 조회 오류:\", error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : \"알 수 없는 오류가 발생했습니다.\",\r\n    };\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 425, "column": 0}, "map": {"version":3,"sources":["file:///C:/cording/landing-page-design/actions/notion.ts"],"sourcesContent":["\"use server\";\n\ninterface SubmitWaitlistFormResult {\n  success: boolean;\n  error?: string;\n}\n\ninterface LoginResult {\n  success: boolean;\n  error?: string;\n  userType?: string;\n}\n\nexport async function submitWaitlistForm(\n  name: string,\n  email: string,\n  phone: string,\n  userType?: string\n): Promise<SubmitWaitlistFormResult> {\n  try {\n    const notionApiKey = process.env.NOTION_API_KEY;\n    const notionDatabaseId = process.env.NOTION_DATABASE_ID;\n\n    // 환경변수 검증\n    if (!notionApiKey) {\n      console.error(\"NOTION_API_KEY가 설정되지 않았습니다.\");\n      return {\n        success: false,\n        error: \"서버 설정 오류: API 키가 없습니다.\",\n      };\n    }\n\n    if (!notionDatabaseId) {\n      console.error(\"NOTION_DATABASE_ID가 설정되지 않았습니다.\");\n      return {\n        success: false,\n        error: \"서버 설정 오류: 데이터베이스 ID가 없습니다.\",\n      };\n    }\n\n    // 기본 속성 구성\n    const properties: Record<string, any> = {\n      이름: {\n        title: [\n          {\n            text: {\n              content: name,\n            },\n          },\n        ],\n      },\n      이메일: {\n        email: email,\n      },\n      전화번호: {\n        phone_number: phone,\n      },\n    };\n\n    // 사용자유형이 있으면 속성에 추가\n    // 노션 데이터베이스에 속성이 없으면 오류가 발생할 수 있으므로\n    // 오류 발생 시 사용자유형 없이 재시도\n    if (userType) {\n      properties.사용자유형 = {\n        select: {\n          name: userType,\n        },\n      };\n    }\n\n    // Notion API 호출\n    const response = await fetch(\"https://api.notion.com/v1/pages\", {\n      method: \"POST\",\n      headers: {\n        Authorization: `Bearer ${notionApiKey}`,\n        \"Content-Type\": \"application/json\",\n        \"Notion-Version\": \"2022-06-28\",\n      },\n      body: JSON.stringify({\n        parent: {\n          database_id: notionDatabaseId,\n        },\n        properties,\n      }),\n    });\n\n    // 응답 처리\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      console.error(\"Notion API 오류 응답:\", {\n        status: response.status,\n        statusText: response.statusText,\n        error: errorData,\n      });\n\n      // 사용자유형 속성 오류인 경우, 사용자유형 없이 재시도\n      if (\n        userType &&\n        (errorData.message?.includes(\"사용자유형\") ||\n          errorData.message?.includes(\"is not a property\"))\n      ) {\n        console.log(\"사용자유형 속성이 없어 기본 속성만으로 저장 시도\");\n        const propertiesWithoutUserType: Record<string, any> = {\n          이름: {\n            title: [\n              {\n                text: {\n                  content: name,\n                },\n              },\n            ],\n          },\n          이메일: {\n            email: email,\n          },\n          전화번호: {\n            phone_number: phone,\n          },\n        };\n\n        const retryResponse = await fetch(\"https://api.notion.com/v1/pages\", {\n          method: \"POST\",\n          headers: {\n            Authorization: `Bearer ${notionApiKey}`,\n            \"Content-Type\": \"application/json\",\n            \"Notion-Version\": \"2022-06-28\",\n          },\n          body: JSON.stringify({\n            parent: {\n              database_id: notionDatabaseId,\n            },\n            properties: propertiesWithoutUserType,\n          }),\n        });\n\n        if (retryResponse.ok) {\n          const retryResult = await retryResponse.json().catch(() => null);\n          if (retryResult) {\n            console.log(\n              \"사용자유형 없이 데이터베이스에 성공적으로 저장되었습니다:\",\n              retryResult.id\n            );\n          }\n          return {\n            success: true,\n          };\n        }\n      }\n\n      // 에러 메시지 추출\n      let errorMessage = `API 오류 (${response.status})`;\n      if (errorData.message) {\n        errorMessage = errorData.message;\n      } else if (errorData.code) {\n        errorMessage = `오류 코드: ${errorData.code}`;\n      }\n\n      return {\n        success: false,\n        error: errorMessage,\n      };\n    }\n\n    // 성공 응답 확인\n    const result = await response.json().catch(() => null);\n    if (result) {\n      console.log(\n        \"Notion 데이터베이스에 성공적으로 저장되었습니다:\",\n        result.id\n      );\n    }\n\n    return {\n      success: true,\n    };\n  } catch (error) {\n    console.error(\"폼 제출 중 예외 발생:\", error);\n    return {\n      success: false,\n      error:\n        error instanceof Error\n          ? error.message\n          : \"네트워크 오류가 발생했습니다. 다시 시도해주세요.\",\n    };\n  }\n}\n\nexport async function verifyLogin(\n  name: string,\n  email: string,\n  phone: string\n): Promise<LoginResult> {\n  try {\n    const notionApiKey = process.env.NOTION_API_KEY;\n    const notionDatabaseId = process.env.NOTION_DATABASE_ID;\n\n    // 환경변수 검증\n    if (!notionApiKey) {\n      console.error(\"NOTION_API_KEY가 설정되지 않았습니다.\");\n      return {\n        success: false,\n        error: \"서버 설정 오류: API 키가 없습니다.\",\n      };\n    }\n\n    if (!notionDatabaseId) {\n      console.error(\"NOTION_DATABASE_ID가 설정되지 않았습니다.\");\n      return {\n        success: false,\n        error: \"서버 설정 오류: 데이터베이스 ID가 없습니다.\",\n      };\n    }\n\n    // Notion API로 데이터베이스 쿼리\n    const response = await fetch(\n      `https://api.notion.com/v1/databases/${notionDatabaseId}/query`,\n      {\n        method: \"POST\",\n        headers: {\n          Authorization: `Bearer ${notionApiKey}`,\n          \"Content-Type\": \"application/json\",\n          \"Notion-Version\": \"2022-06-28\",\n        },\n        body: JSON.stringify({\n          filter: {\n            and: [\n              {\n                property: \"이름\",\n                title: {\n                  contains: name,\n                },\n              },\n              {\n                property: \"이메일\",\n                email: {\n                  equals: email,\n                },\n              },\n              {\n                property: \"전화번호\",\n                phone_number: {\n                  equals: phone,\n                },\n              },\n            ],\n          },\n        }),\n      }\n    );\n\n    // 응답 처리\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      console.error(\"Notion API 오류 응답:\", {\n        status: response.status,\n        statusText: response.statusText,\n        error: errorData,\n      });\n\n      return {\n        success: false,\n        error: \"로그인 확인 중 오류가 발생했습니다.\",\n      };\n    }\n\n    const result = await response.json().catch(() => null);\n\n    if (!result || !result.results || result.results.length === 0) {\n      return {\n        success: false,\n        error: \"일치하는 사용자 정보를 찾을 수 없습니다.\",\n      };\n    }\n\n    // 모든 결과를 확인하여 정확히 일치하는 사용자 찾기\n    for (const user of result.results) {\n      const userName = user.properties?.이름?.title?.[0]?.text?.content || \"\";\n      const userEmail = user.properties?.이메일?.email || \"\";\n      const userPhone = user.properties?.전화번호?.phone_number || \"\";\n\n      // 정확히 일치하는지 확인 (contains로 필터링했지만 정확한 일치 확인)\n      if (userName === name && userEmail === email && userPhone === phone) {\n        const userType = user.properties?.사용자유형?.select?.name || undefined;\n\n        return {\n          success: true,\n          userType,\n        };\n      }\n    }\n\n    // 필터링된 결과가 있지만 정확히 일치하지 않음\n    return {\n      success: false,\n      error: \"일치하는 사용자 정보를 찾을 수 없습니다.\",\n    };\n  } catch (error) {\n    console.error(\"로그인 검증 중 예외 발생:\", error);\n    return {\n      success: false,\n      error:\n        error instanceof Error\n          ? error.message\n          : \"네트워크 오류가 발생했습니다. 다시 시도해주세요.\",\n    };\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 686, "column": 0}, "map": {"version":3,"sources":["file:///C:/cording/landing-page-design/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {sendChatMessage as '60da9626967c432fb7b5f35c996fffe514b45031ed'} from 'ACTIONS_MODULE0'\nexport {collectNews as '00d17b4b1da97279cdc73a668fc1e8474570adec9b'} from 'ACTIONS_MODULE1'\nexport {getNews as '407f1564b5ff55eb1c9dc3eaa2df65efd22c87db84'} from 'ACTIONS_MODULE1'\nexport {submitWaitlistForm as '78a333388d3e2db9241a5de54a510b23b3813ec8e2'} from 'ACTIONS_MODULE2'\nexport {verifyLogin as '70d459a2e42df3de227639d653795394176f4096ee'} from 'ACTIONS_MODULE2'\n"],"names":[],"mappings":";AAAA;AACA;AAEA"}}]
}